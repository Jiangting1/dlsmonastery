<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.myspring.future.modules.crm.mapper.PricesystemChangeMapper">
    <select id="findPage" resultType="PricesystemChangeDto">
        SELECT
        t1.*,t2.name as productName,t3.name as pricesystemName
        FROM
        crm_pricesystem_change t1,crm_product t2 , crm_pricesystem t3
        WHERE
        t1.enabled=1 and t1.product_id=t2.id and t1.pricesystem_id=t3.id
        <if test="p.productName != null">
            and t1.product_id in(
            select t2.id
            from crm_product t2
            where t2.name LIKE CONCAT('%',#{p.productName},'%')
            )
        </if>
        <if  test="p.pricesystemId!=null">
            and t1.pricesystem_id =#{p.pricesystemId}
        </if>
        <if test="p.status != null">
            AND t1.status  = #{p.status}
        </if>
        <if test="p.createdDateStart !=null">
            and t1.created_date >= #{p.createdDateStart}
        </if>
        <if test="p.createdDateEnd !=null">
            and t1.created_date &lt;= #{p.createdDateEnd}
        </if>
    </select>

</mapper>
