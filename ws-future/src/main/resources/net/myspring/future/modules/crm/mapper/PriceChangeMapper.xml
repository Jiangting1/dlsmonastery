<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.myspring.future.modules.crm.mapper.PriceChangeMapper">


    <select id="findPage" resultType="PriceChangeDto">
        SELECT
            group_concat(DISTINCT productType.name) productTypeName, t1.*
        FROM
        crm_price_change t1,crm_price_change_product product,crm_product_type productType
        WHERE
        t1.enabled=1
        AND product.product_type_id = productType.id
        AND product.price_change_id = t1.id
        <if test="p.name != null">
            AND t1.name LIKE CONCAT('%',#{p.name},'%')
        </if>
        GROUP BY product.price_change_id
    </select>

    <select id="findNearPriceChange" resultType="PriceChange">
        SELECT t1.*
        FROM crm_price_change t1
        ORDER BY  t1.price_change_date DESC ,t1.upload_end_date DESC
        limit 0,1
    </select>

    <select id="finAllByEnabled" resultType="PriceChange">
            SELECT t1.*
            FROM crm_price_change t1
            where
              t1.upload_end_date>=#{uploadEndDate}
               and t1.enabled=1
            ORDER BY  t1.id DESC
    </select>
</mapper>
