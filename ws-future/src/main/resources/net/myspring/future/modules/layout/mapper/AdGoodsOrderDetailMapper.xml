<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.myspring.future.modules.layout.mapper.AdGoodsOrderDetailMapper">

    <select id="findByAdGoodsOrderIds" resultType="AdGoodsOrderDetailDto">
        SELECT t1.*
        FROM crm_ad_goods_order_detail t1
        where t1.ad_goods_order_id IN
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="findByAdGoodsOrderForEdit" resultType="AdGoodsOrderDetailDto">
        SELECT validProduct.id productId,validProduct.name productName,validProduct.code productCode,t1.*
        FROM (select t1.id id, t1.name productName
        from crm_product t1
        where t1.id in (select t2.product_id from crm_ad_good_order_detail t2 where t2.product_id = (select product1.pricesystem_id from crm_product product1 where product1.id = #{fromDepotId}))
        and t1.id in (select t3.product_id from crm_ad_good_order_detail t3 where t3.product_id =  (select product2.pricesystem_id from crm_product product2 where product2.id = #{toDepotId}))
        and t1.enabled=1) validProduct LEFT JOIN crm_ad_good_order_detail detail
        ON validProduct.id = detail.product_id and  detail.ad_good_order_id = #{adGoodsOrderId}
    </select>
</mapper>
