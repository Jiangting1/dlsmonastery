<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.myspring.future.modules.basic.mapper.DepotShopMapper">

    <select id="findDepotDtoList" resultType="DepotDto">
        SELECT t1.*
        FROM crm_depot t1,crm_depot_shop t2
        where t1.depot_shop_id=t2.id
        and t1.enabled=1
        and t2.enabled=1
        <if test="p.direct">
            and t2.client_id is not NULL
            and t2.client_id in (
                SELECT id
                FROM crm_client
                where enabled=1
                and out_id is not NULL
            )
        </if>
        <if test="p.delegate">
            and t1.client_id is NULL
        </if>
        <if test="p.directAndSub">
           and t2.client_id is not NULL
        </if>
        and t1.name like concat('%',#{p.key},'%')
        limit 0,25
    </select>

</mapper>
