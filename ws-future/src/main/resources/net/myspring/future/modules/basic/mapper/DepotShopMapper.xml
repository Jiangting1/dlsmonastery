<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.myspring.future.modules.basic.mapper.DepotShopMapper">

    <select id="findDepotDtoList" resultType="DepotDto">
        SELECT t1.*
        FROM crm_depot t1,crm_depot_shop t2
        where t1.depot_shop_id=t2.id
        and t1.enabled=1
        and t2.enabled=1
        <if test="p.direct">
            and t1.out_id is not NULL
            and t1.out_type='门店'
        </if>
        <if test="p.delegate">
            and t1.parent_id is NULL
            AND t1.out_id is NULL
        </if>
        <if test="p.directAndSub">
            AND (
                t1.out_id IS NOT NULL
                AND t1.out_type = '门店'
                OR t1.parent_id IS NOT NULL
            )
        </if>
        and t1.name like concat('%',#{p.key},'%')
    </select>

    <select id="findPage" resultType="DepotDto">
        select depot.*
        from crm_depot depot
        where
        depot.enabled=1
        <if test="name !=null">
            and depot.name like concat('%',#{name},'%')
        </if>
        <if test="category !=null">
            and depot.category = category
        </if>
    </select>


</mapper>
