<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.myspring.future.modules.crm.mapper.ShopPromotionMapper">

<select id="findPage" resultType="ShopPromotion">
    SELECT
    t1.*
    FROM
    crm_shop_promotion t1,crm_depot depot
    WHERE
    t1.enabled=1
    and t1.shop_id = depot.id
    <if test="p.createdDateStart !=null">
        AND depot.created_date>= #{p.createdDateStart}
    </if>
    <if test="p.createdDateEnd != null">
        AND t1.created_date &lt;= #{p.createdDateEnd}
    </if>
    <if test = "p.businessId !=null">
        AND t1.business_id LIKE CONCAT('%',#{p.businessId},'%')
    </if>
    <if test = "p.activityType !=null">
        AND t1.activity_type = #{p.activityType}
    </if>
    <if test="p.shopName !=null">
        AND depot.name LIKE CONCAT('%',#{p.shopName},'%')
    </if>
    <include refid="net.myspring.future.modules.crm.mapper.DepotMapper.depotFilter" />
</select>

    <select id="findMaxBusinessId" resultType="String">
        SELECT
       MAX(t1.business_id)
        FROM
        crm_shop_promotion t1
        WHERE
            t1.created_date>=#{localDate}
    </select>
</mapper>
