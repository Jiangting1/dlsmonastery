<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.myspring.future.modules.crm.mapper.DepotChangeMapper">
    <select id="findPage" resultType="DepotChange">
        select t.*
        from crm_depot_change t
        where
        t.enabled=1
        <include refid="depotChangeFilter"/>
    </select>


    <select id="findByFilter" resultType="DepotChange">
        SELECT
        t.*
        FROM
        crm_depot_change t
        WHERE
        t.enabled=1
        <include refid="depotChangeFilter"/>
    </select>

    <sql id="depotChangeFilter">
        <if test="p.type !=null and p.depotName !=''">
            AND t.type=#{p.type}
        </if>
        <if test="p.depotName != null and p.depotName !=''">
            AND t.depot_id in (
            select t1.id
            from crm_depot t1
            where t1.name LIKE CONCAT('%',#{p.depotName},'%')
            )
        </if>
        <if test="p.createdDateStart !=null">
            and t1.created_date >= #{p.createdDateStart}
        </if>
        <if test="p.createdDateEnd !=null">
            and t1.created_date &lt;= #{p.createdDateEnd}
        </if>
    </sql>

</mapper>
