<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.myspring.basic.modules.sys.mapper.PermissionMapper">

    <select id="findPage" resultType="PermissionDto">
        SELECT
        t1.*
        FROM
        sys_permission t1
        WHERE
        t1.enabled=1
        <if test="p.name != null">
            AND t1.name LIKE CONCAT('%',#{p.name},'%')
        </if>
        <if test="p.permission != null">
            AND t1.permission LIKE CONCAT('%',#{p.permission},'%')
        </if>
        <if test="p.menuName != null">
            and t1.menu_id in(
            select t4.id
            from sys_menu t4
            where t4.name LIKE CONCAT('%',#{p.menuName},'%')
            )
        </if>
    </select>


    <select id="findByPositionId" resultType="Permission">
        SELECT
        t1.*
        FROM
        sys_permission t1,
        hr_position_permission t2
        where
        t1.id=t2.permission_id
        and t2.position_id=#{positionId}
    </select>

    <select id="findByMenuId" resultType="Permission">
        SELECT
        t1.*
        FROM
        sys_permission t1
        where
        t1.menu_id = #{menuId}
    </select>

    <select id="findByMenuIds" resultType="Permission">
        SELECT
        t1.*
        FROM
        sys_permission t1
        where
        t1.enabled=1
        and t1.menu_id IN
        <foreach collection="list" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="findByPermission" resultType="Permission">
        SELECT
        t1.*
        FROM
        sys_permission t1
        where
        t1.permission = #{permissionStr}
    </select>

    <select id="findByPermissionLike" resultType="Permission">
        SELECT
        t1.*
        FROM
        sys_permission t1
        where
        t1.permission LIKE CONCAT('%',#{permissionStr},'%')
    </select>

    <insert id="savePermissionPosition">
        INSERT INTO hr_position_permission(permission_id,position_id) VALUES
        <foreach collection="positionIds" index="index" item="item" open="" separator="," close="">
            (#{permissionId},#{item})
        </foreach>
    </insert>

    <delete id="deletePermissionPosition">
        DELETE FROM
        hr_position_permission
        where permission_id=#{permissionId}
    </delete>

    <select id="findNameValueByPositionId" resultType="net.myspring.basic.common.dto.NameValueDto">
        SELECT permission_id as 'name',position_id AS 'value'
        FROM hr_position_permission
        where permission_id IN
        <foreach collection="list" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

</mapper>
