<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.myspring.basic.modules.sys.mapper.BackendMapper">

    <select id="findPage" resultType="BackendDto">
        SELECT  t1.*
        FROM sys_backend t1
        where t1.enabled=1
        <if test="p.name!=null">
            and t1.name=#{p.name}
        </if>
    </select>

    <select id="findByNameLike" resultType="Backend">
        SELECT t1.*
        FROM sys_backend t1
        where t1.enabled=1
        and t1.name like concat('%',#{name},'%')
    </select>

    <select id="findByMenuList" resultMap="BackendMenuMap">
        SELECT
            t1.id,
            t1.name,
            t1.code,
            t2.id as 'moduleId',
            t2.name as 'moduleName',
            t2.code as 'moduleCode',
            t2.icon as 'moduleIcon',
            t3.id as 'categoryId',
            t3.name as 'categoryName',
            t3.code as 'categoryCode',
            t4.id as 'menuId',
            t4.name as 'menuName',
            t4.code as 'menuCode'
        FROM
            sys_backend t1,sys_backend_module t2,sys_menu_category t3,sys_menu t4
        where
        t4.menu_category_id=t3.id
        and t3.backend_module_id=t2.id
        and t2.backend_id=t1.id
        and t1.enabled=1
        and t2.enabled=1
        and t3.enabled=1
        and t4.enabled=1
        and t4.id IN
        <foreach collection="list" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <resultMap id="BackendMenuMap" type="BackendMenuDto">
        <id column="id" property="id"/>
        <result column="name" property="name" />
        <result column="code" property="code" />
        <collection property="backendModuleList" resultMap="BackendModuleMenuMap"/>
    </resultMap>

    <resultMap id="BackendModuleMenuMap" type="BackendModuleMenuDto">
        <id column="moduleId" property="id"/>
        <result column="moduleName" property="name" />
        <result column="moduleCode" property="code" />
        <result column="moduleIcon" property="icon" />
        <collection property="menuCategoryList" resultMap="menuCategoryMap"/>
    </resultMap>

    <resultMap id="menuCategoryMap" type="menuCategoryMenuDto">
        <id column="categoryId" property="id"/>
        <result column="categoryName" property="name" />
        <result column="categoryCode" property="code" />
        <collection property="menuList" resultMap="menuMap"/>
    </resultMap>

    <resultMap id="menuMap" type="FrontendMenuDto">
        <id column="menuId" property="id"/>
        <result column="menuName" property="name" />
        <result column="menuCode" property="code" />
    </resultMap>

</mapper>
