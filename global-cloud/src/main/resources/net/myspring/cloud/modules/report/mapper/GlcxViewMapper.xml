<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.myspring.cloud.modules.report.mapper.GlcxViewMapper">
    <select id="findDepartment" resultType="NameNumberDto">
        SELECT DISTINCT
            fdeptnum AS number,
            fdeptname AS name
        FROM
            glcx
        WHERE
            fdeptnum NOT IN ('')
        ORDER BY Fdeptnum
    </select>

    <select id="findDepartmentByDeptNumList" resultType="NameNumberDto">
        SELECT DISTINCT
            fdeptnum AS number,
            fdeptname AS name
        FROM
            glcx
        WHERE
            fdeptnum in
        <foreach item="item" index="index" collection="deptNumList" open="(" separator="," close=")">
            #{item}
        </foreach>
        ORDER BY Fdeptnum
    </select>

    <select id="findTowDepartmentNumber" resultType="String">
        SELECT DISTINCT top 2
            fdeptnum
        FROM
            glcx
        where
            fdeptnum NOT IN ('')
    </select>

    <select id="findEntityByPeriod" resultType="Retail">
        SELECT
            FYEAR as year,
            FPERIOD as month,
            faccnumber as accNumber,
            faccname as accName,
            Fdeptnum as deptNum,
            Fdeptname as deptName,
            Ffynum as fyNum,
            Ffyname as fyName,
            SUM (famount) AS amount
        FROM
          glcx
        WHERE
            flx = ''
            AND Fyear = #{year} and Fperiod = #{month}
            AND faccname = #{accName}
            <if test="fyNum != '' and fyNum != null">
                AND Ffynum = #{fyNum}
            </if>
        GROUP BY
            FYEAR,
            FPERIOD,
            faccnumber,
            faccname,
            Fdeptnum,
            Fdeptname,
            Ffynum,
            Ffyname
    </select>
    <select id="findEntityBySumPeriod" resultType="Retail">
        SELECT
        faccnumber as accNumber,
        faccname as accName,
        Fdeptnum as deptNum,
        Fdeptname as deptName,
        Ffynum as fyNum,
        Ffyname as fyName,
        SUM (famount) AS amount
        FROM
        glcx
        WHERE
        flx = ''
        AND FYEAR*100+ FPERIOD BETWEEN  #{dateStart} AND #{dateEnd}
        AND faccname = #{accName}
        <if test="fyNum != '' and fyNum != null">
            AND Ffynum = #{fyNum}
        </if>
        GROUP BY
        faccnumber,
        faccname,
        Fdeptnum,
        Fdeptname,
        Ffynum,
        Ffyname
    </select>

    <select id="findEntityByPeriodAndDeptNumList" resultType="Retail">
        SELECT
        FYEAR as year,
        FPERIOD as month,
        faccnumber as accNumber,
        faccname as accName,
        Fdeptnum as deptNum,
        Fdeptname as deptName,
        Ffynum as fyNum,
        Ffyname as fyName,
        SUM (famount) AS amount
        FROM
        glcx
        WHERE
        flx = ''
        AND Fyear = #{year} and Fperiod = #{month}
        AND faccname = #{accName}
        <if test="fyNum != '' and fyNum != null">
            AND Ffynum = #{fyNum}
        </if>
        and fdeptnum in
        <foreach item="item" index="index" collection="deptNumList" open="(" separator="," close=")">
            #{item}
        </foreach>
        GROUP BY
        FYEAR,
        FPERIOD,
        faccnumber,
        faccname,
        Fdeptnum,
        Fdeptname,
        Ffynum,
        Ffyname
    </select>
    <select id="findEntityBySumPeriodAndDeptNumList" resultType="Retail">
        SELECT
        faccnumber as accNumber,
        faccname as accName,
        Fdeptnum as deptNum,
        Fdeptname as deptName,
        Ffynum as fyNum,
        Ffyname as fyName,
        SUM (famount) AS amount
        FROM
        glcx
        WHERE
        flx = ''
        AND FYEAR*100+ FPERIOD BETWEEN  #{dateStart} AND #{dateEnd}
        AND faccname = #{accName}
        <if test="fyNum != '' and fyNum != null">
            AND Ffynum = #{fyNum}
        </if>
        and fdeptnum in
        <foreach item="item" index="index" collection="deptNumList" open="(" separator="," close=")">
            #{item}
        </foreach>
        GROUP BY
        faccnumber,
        faccname,
        Fdeptnum,
        Fdeptname,
        Ffynum,
        Ffyname
    </select>

    <select id="findEntityByPeriodForTotalDepartment" resultType="Retail">
        SELECT
            FYEAR as year,
            FPERIOD as month,
            faccnumber as accNumber,
            faccname as accName,
            Ffynum as fyNum,
            Ffyname as fyName,
            SUM (famount) AS amount
        FROM
            glcx
        WHERE
            flx = ''
            AND Fyear = #{year} and Fperiod = #{month}
            AND faccname = #{accName}
            <if test="fyNum != '' and fyNum != null">
                AND Ffynum = #{fyNum}
            </if>
        GROUP BY
            FYEAR,
            FPERIOD,
            faccnumber,
            faccname,
            Ffynum,
            Ffyname
    </select>
    <select id="findEntityBySumPeriodForTotalDepartment" resultType="Retail">
        SELECT
        faccnumber as accNumber,
        faccname as accName,
        Ffynum as fyNum,
        Ffyname as fyName,
        SUM (famount) AS amount
        FROM
          glcx
        WHERE
        flx = ''
        AND FYEAR*100+ FPERIOD BETWEEN  #{dateStart} AND #{dateEnd}
        AND faccname = #{accName}
        <if test="fyNum != '' and fyNum != null">
            AND Ffynum = #{fyNum}
        </if>
        GROUP BY
        faccnumber,
        faccname,
        Ffynum,
        Ffyname
    </select>

    <select id="findByAccName" resultType="AccountSubjectDto">
        SELECT DISTINCT
            faccnumber as accNumber,
            faccname as accName,
            Ffynum as fyNum,
            Ffyname as fyName
        FROM
            glcx
        WHERE
            flx = '' AND faccname = #{accName}
    </select>
</mapper>